# Copyright Suunto Oy 2015-2016
# All rights reserved.

swagger: '2.0'

# Document metadata
info:
  version: "0.9.0"
  title: /Device/GNSS API
  description: |
    This file defines the /Device/GNSS (Global Navigation Satellite System) API.
  termsOfService: http://suunto.com/wbapi/terms/
  contact:
    name: Suunto team
    url: http://developer.suunto.com

# Security definitions
security:
  - suuntoAccessCode:
    - public

securityDefinitions:
  suuntoAccessCode:
    type: oauth2
    scopes:
      public: Grants read/write access to public resources.
    flow: accessCode
    authorizationUrl: https://suunto.com/wbapi/login/oauth/authorize
    tokenUrl: https://suunto.com/wbapi/login/oauth/access_token

# Paths
paths:
  /Device/GNSS/NavigationSystem:
    x-executionContext: meas
    get:
      description: |
        Get the current navigation systems in use.
      responses:
        200:
          description: |
            Navigation systems. This returns an array of the actual navigation systems
            in use.
          schema:
            $ref: '#/definitions/NavigationSystemArray'
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#get
      security:
        - suuntoAccessCode:
          - public
    put:
      description: |
        Set the current navigation systems.
      parameters:
        - name: value
          in: body
          description: Navigation systems to be taken into use.
          required: true
          schema:
            $ref: '#/definitions/NavigationSystemArray'
      responses:
        200:
          description: Operation completed successfully
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/Mode:
    x-executionContext: meas
    get:
      description: |
        Get the current GNSS tracking mode.
      responses:
        200:
          description: GNSS mode value
          schema:
            $ref: '#/definitions/GnssMode'
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#get
      security:
        - suuntoAccessCode:
          - public
    put:
      description: |
        Forces a GNSS tracking mode (currently used for HIBERNATE only).
      parameters:
        - name: mode
          in: body
          description: New GNSS mode.
          required: true
          schema:
            $ref: '#/definitions/GnssMode'
      responses:
        200:
          description: Operation completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/Mode/Subscription:
    x-executionContext: meas
    post:
      description: |
        Client can post itself (subscribe) under this resource to receive notifications 
        about changes in current GNSS tracking mode.
      responses:
        200:
          description: Operation completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
        x-notification:
          description: |
            GNSS tracking mode event notification. 
          schema:
            $ref: '#/definitions/GnssMode'
      security:
        - suuntoAccessCode:
          - public
    delete:
      tags:
        - Suunto API
      description: |
        Client can remove it's subscribtion by deleting itself from this resource.
      responses:
        200:
          description: Operation completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#unsubscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/Fix/BasicData:
    x-executionContext: meas
    get:
      description: |
        Get binary dump of basic data from GNSS fix.
      responses:
        200:
          description: Basic GNSS fix data
          schema:
            $ref: '#/definitions/GnssBasicData'
        204:
          description: Measurement source is unavailable
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#get
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/Fix/BasicData/Subscription:
    x-executionContext: meas
    post:
      description: |
        Client can post itself (subscribe) under this resource to receive binary dump of GNSS fix change notifications.
        Wanted GNSS service level as a parameter. Client can subscribe only as a listener by not giving service level as a parameter.
      parameters:
        - name: ServiceLevel
          in: body
          required: false
          description: Location service level. 
          schema:
            $ref: '#/definitions/GnssServiceLevel'
      responses:
        200:
          description: Operation completed successfully
          schema:
            $ref: '#/definitions/GnssBasicData'
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
        x-notification:
          description: |
            GNSS fix event notification.
            In case of invalid coordinates, notification value is empty 
          schema:
            $ref: '#/definitions/GnssBasicData'
      security:
        - suuntoAccessCode:
          - public
    delete:
      description: |
        Unsubscribe the client from the basic GNSS fix change notification.
      responses:
        200:
          description: Operation completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#unsubscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/Fix/FullData:
    x-executionContext: meas
    get:
      description: |
        Get binary dump of full data from GNSS fix.
      responses:
        200:
          description: Full GNSS fix data
          schema:
            $ref: '#/definitions/GnssFullData'
        204:
          description: Measurement source is unavailable
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#get
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/Fix/FullData/Subscription:
    x-executionContext: meas
    post:
      description: |
        Subscribe the client to receive binary dump of full GNSS fix change notifications.
        Wanted GNSS service level as a parameter. Client can subscribe only as a listener by not giving service level as a parameter.
      parameters:
        - name: ServiceLevel
          in: body
          required: false
          description: Location service level.
          schema:
            $ref: '#/definitions/GnssServiceLevel'
      responses:
        200:
          description: Operation completed successfully
          schema:
            $ref: '#/definitions/GnssFullData'
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
        x-notification:
          description: |
           Event notification.
          schema:
            $ref: '#/definitions/GnssFullData'
      security:
        - suuntoAccessCode:
          - public
    delete:
      description: |
        Unsubscribe the client from the full GNSS fix change notifications.
      responses:
        200:
          description: Operation completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#unsubscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/ExtendedEphemerisData:
    x-executionContext: meas
    put:
      description: |
        Force download of existing extended ephemeris data files to GNSS.
      responses:
        200:
          description: Operation completed successfully
      security:
        - suuntoAccessCode:
          - public
    delete:
      description: |
        Force remove of existing extended ephemeris data files in watch.
      responses:
        200:
          description: Operation completed successfully
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/ExtendedEphemerisData/Date:
    x-executionContext: meas
    get:
      description: |
        Get extended ephemeris data date.
      responses:
        200:
          description: |
            Date in string format "x.x.xxxx" or "N/A".
          schema:
            type: string
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/SyncState:
    x-executionContext: meas
    get:
      description: |
        Gets synchronization status
      responses:
        200:
          description: Operation completed successfully
          schema:
            $ref: 'http://localhost:9000/suunto_inetgw.yaml#/definitions/SyncClientSyncStatus'
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/SyncState/Subscription:
    x-executionContext: meas
    post:
      description: |
        Subscribes the client to receice synchronization status updates
      responses:
        200:
          description: Operation completed successfully
          schema:
            $ref: 'http://localhost:9000/suunto_inetgw.yaml#/definitions/SyncClientSyncStatus'
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
        x-notification:
          description: |
           Event notification.
          schema:
            $ref: 'http://localhost:9000/suunto_inetgw.yaml#/definitions/SyncClientSyncStatus'
            # type: integer
            # format: uint32
      security:
        - suuntoAccessCode:
          - public
    delete:
      description: |
        Unsubscribes the client from synchronization status updates
      responses:
        200:
          description: Operation completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#unsubscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/SyncCommand:
    x-executionContext: meas
    put:
      description: |
        Subscribes the client to receice synchronization status updates
      parameters:
        - name: value
          in: body
          description: Synchronization command
          required: true
          schema:
            $ref: 'http://localhost:9000/suunto_inetgw.yaml#/definitions/SyncCommand'
      responses:
        200:
          description: Operation completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/SyncProgress:
    x-executionContext: meas
    get:
      description: |
        Gets synchronization progress
      responses:
        200:
          description: Operation completed successfully
          schema:
            $ref: 'http://localhost:9000/suunto_inetgw.yaml#/definitions/SyncClientSyncProgress'
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/SyncProgress/Subscription:
    x-executionContext: meas
    post:
      description: |
        Subscribes the client to receice synchronization progress updates
      responses:
        200:
          description: Operation completed successfully
          schema:
            $ref: 'http://localhost:9000/suunto_inetgw.yaml#/definitions/SyncClientSyncProgress'
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
        x-notification:
          description: |
           Event notification.
          schema:
            $ref: 'http://localhost:9000/suunto_inetgw.yaml#/definitions/SyncClientSyncProgress'
      security:
        - suuntoAccessCode:
          - public
    delete:
      description: |
        Unsubscribes the client from synchronization progress value updates.
      responses:
        200:
          description: Operation completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#unsubscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/Version:
    x-executionContext: meas
    get:
      description: |
        Get available version info from GNSS chip.
      responses:
        200:
          description:  |
            Available version infos from GNSS chip
          schema:
            $ref: 'http://localhost:9000/suunto_shared.yaml#/definitions/VersionInfoArray'
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#get
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/Upgrade:
    x-executionContext: meas

  /Device/GNSS/Upgrade/Subscription:
    x-executionContext: meas
    post:
      description: By subscribing this resource the client starts the GNSS firmware upgrade
        procedure and is periodically notified with status/progress indications.
      parameters:
        - name: FirmwareFileName
          description: File name for the new GNSS firmware.
          in: query
          required: true
          type: string
        - name: LoaderFileName
          description: File name for the GNSS firmware loader binary.
          in: query
          required: false
          type: string
      responses:
        200:
          description: Upgrade started successfully.
        406:
          description: Upgrade start error or already in progress,
            file not found or file format or version not supported.
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
        x-notification:
          description: Feedback for upgrade status/progress.
          schema:
            $ref: 'http://localhost:9000/suunto_shared.yaml#/definitions/UpgradeStatus'
      security:
        - suuntoAccessCode:
          - public

    delete:
      description: After successful (or unsuccessful) upgrade the client should release the resource by unsubscribe.
      responses:
        200:
          description: Client unsubscribtion completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#unsubscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/BestSNR:
    x-executionContext: meas
    get:
      description: |
        Get 5 best SNR.
      responses:
        200:
          description: SNR of 5 best satellites.
          schema:
            type: number
            format: float
        204:
          description: Measurement source is unavailable
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#get
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/BestSNR/Subscription:
    x-executionContext: meas
    post:
      description: |
        Subscribes the client to receive SNR of 5 best satellites updates
      responses:
        200:
          description: Operation completed successfully
          schema:
            type: number
            format: float
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
        x-notification:
          description: |
           Event notification.
          schema:
            type: number
            format: float
      security:
        - suuntoAccessCode:
          - public
    delete:
      description: |
        Unsubscribes the client from value updates.
      responses:
        200:
          description: Operation completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#unsubscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/EHPE:
    x-executionContext: meas
    get:
      description: |
        Get EHPE.
      responses:
        200:
          description: EHPE.
          schema:
            type: integer
            format: uint16
        204:
          description: Measurement source is unavailable
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#get
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/EHPE/Subscription:
    x-executionContext: meas
    post:
      description: |
        Subscribes the client to receive EHPE updates
      responses:
        200:
          description: Operation completed successfully
          schema:
            type: integer
            format: uint16
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
        x-notification:
          description: |
           Event notification.
          schema:
            type: integer
            format: uint16
      security:
        - suuntoAccessCode:
          - public
    delete:
      description: |
        Unsubscribes the client from value updates.
      responses:
        200:
          description: Operation completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#unsubscribe
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/Satellites:
    x-executionContext: meas
    get:
      description: |
        Number of satellites.
      responses:
        200:
          description: number of satellites.
          schema:
            type: integer
            format: uint16
        204:
          description: Measurement source is unavailable
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#get
      security:
        - suuntoAccessCode:
          - public

  /Device/GNSS/Satellites/Subscription:
    x-executionContext: meas
    post:
      description: |
        Subscribes the client to receive satellites number updates
      responses:
        200:
          description: Operation completed successfully
          schema:
            type: integer
            format: uint16
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#subscribe
        x-notification:
          description: |
           Event notification.
          schema:
            type: integer
            format: uint16
      security:
        - suuntoAccessCode:
          - public
    delete:
      description: |
        Unsubscribes the client from value updates.
      responses:
        200:
          description: Operation completed successfully
        x-std-errors:
          description: See common error codes http://developer.suunto.com/api/std-errors#unsubscribe
      security:
        - suuntoAccessCode:
          - public

# Extra definitions
definitions:

  GlobalNavigationSystem:
    type: integer
    format: uint8
    enum:
      - name: GPS
        description: GPS navigation system is in use
        value: 1
      - name: GLONASS
        description: GLONASS navigation system is in use
        value: 2
      - name: GALILEO
        description: GALILEO navigation system is in use
        value: 3
      - name: BEIDOU
        description: BEIDOU navigation system is in use
        value: 4
      - name: NAVIC
        description: NAVIC navigation system is in use
        value: 5

  GnssMode:
    type: integer
    format: uint8
    enum:
      - name: 'PowerOff'
        description: |
          The GNSS unit is powered off.
        value: 100
      - name: 'Testing'
        description: |
          The GNSS unit is in special test operational mode.
        value: 99
      - name: 'Best'
        description: |
          The GNSS unit operates at best available performance.
        value: 15
      - name: 'Good'
        description: |
          The GNSS unit operates at second best available performance.
        value: 10
      - name: 'Ok'
        description: |
          The GNSS unit operates at third best available performance.
        value: 5
      - name: 'Hibernate'
        description: |
          The GNSS unit is hibernating (with fast wakeup possible).
        value: 0

  GnssServiceLevel:
    type: integer
    format: uint8
    enum:
      - name: 'Best'
        value: 15
      - name: 'Good'
        value: 10
      - name: 'Ok'
        value: 5
      - name: 'Passive'
        value: 0

  GnssDate:
    required:
      - year
      - month
      - day
    properties:
      year:
        type: integer
        format: uint16
      month:
        type: integer
        format: uint8
      day:
        type: integer
        format: uint8

  GnssTime:
    required:
      - hour
      - minute
      - secondMs
    properties:
      hour:
        type: integer
        format: uint8
      minute:
        type: integer
        format: uint8
      secondMs:
        type: integer
        format: uint16

  GnssCoordinateFixedPoint:
    required:
      - latitude
      - longitude
    properties:
      latitude:
        description: |
          [deg]*10^7
        type: integer
        format: int32
        minimum: -900000000
        maximum: 900000000
      longitude:
        description: |
          [deg]*10^7
        type: integer
        format: int32
        minimum: -1800000000
        maximum: 1800000000

  GnssSatelliteData:
    required:
      - satelliteId
      - state
      - snr
    properties:
      satelliteId:
        type: integer
        format: uint8
      snr:
        type: integer
        format: uint8
      state:
        type: integer
        format: uint16

  GnssBasicData:
    required:
      - fixValid
      - fixFound
      - fixReadiness
      - utcDate
      - utcTime
      - coordinates
      - altitudeFromMSL
      - ehpe
    properties:
      fixValid:
        type: boolean
      fixFound:
        type: boolean
      fixReadiness:
        type: integer
        format: uint8
      utcDate:
        $ref: '#/definitions/GnssDate'
      utcTime:
        $ref: '#/definitions/GnssTime'
      coordinates:
        $ref: '#/definitions/GnssCoordinateFixedPoint'
      altitudeFromMSL:
        description: Altitude from Mean Sea Level ([m])
        type: number
        format: float
      ehpe:
        description: Estimated Horizontal Position Error ([m])
        type: number
        format: float

  GnssFullData:
    required:
      - gnssBasicData
      - navValid
      - navType
      - hdop
      - trickle
      - fixRateApproximation
      - speedOverGround
      - courseOverGround
      - numberOfSatellitesInSolution
      - satelliteData
      - distance
    properties:
      gnssBasicData:
        $ref: '#/definitions/GnssBasicData'
      navValid:
        description: Solution Validity register value
        type: integer
        format: uint16
      navType:
        description: Solution Type register value
        type: integer
        format: uint16
      hdop:
        description: Horizontal Dilution Of Precision (resolution 0.2)
        type: integer
        format: uint16
      trickle:
        type: boolean
      fixRateApproximation:
        type: integer
        format: uint16
      speedOverGround:
        description: Speed ([m/s] resolution 0.01)
        type: integer
        format: uint16
      courseOverGround:
        description: Direction ([deg] resolution 0.01)
        type: integer
        format: uint16
      numberOfSatellitesInSolution:
        type: integer
        format: uint8
      satelliteData:
        type: array
        maxItems: 12
        items:
          $ref: '#/definitions/GnssSatelliteData'
      distance:
        description: Distance traveled since reset in meters.
        type: integer
        format: uint32

  NavigationSystemArray:
    required:
      - data
    properties:
      data:
        type: array
        items:
          $ref: '#/definitions/GlobalNavigationSystem'

